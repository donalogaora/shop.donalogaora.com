<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Checkout | Dónal Ó Gaora</title>
    <meta name="description" content="Checkout any product from shop.donalogaora.com here!">
    <meta name="keywords" content="Dónal Ó Gaora, donalogaora, online shop, email, PayPal, 3D prints, 3D printed, custom, postage, delivery, cart, checkout">
    <meta name="author" content="Dónal Ó Gaora">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Checkout | Dónal Ó Gaora">
    <meta property="og:description" content="Checkout any product from shop.donalogaora.com here!">
    <meta property="og:image" content="https://shop.donalogaora.com/assets/dog.webp">
    <meta property="og:url" content="https://shop.donalogaora.com/checkout">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Checkout | Dónal Ó Gaora">
    <meta name="twitter:description" content="Checkout any product from shop.donalogaora.com here!">
    <meta name="twitter:image" content="https://shop.donalogaora.com/assets/dog.webp">
    <link rel="canonical" href="https://shop.donalogaora.com/checkout">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon.ico/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon.ico/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicon.ico/favicon-16x16.png" />
    <link rel="manifest" href="../assets/favicon.ico/site.webmanifest" />
    <link rel="icon" href="../assets/favicon.ico/favicon.ico" type="image/x-icon" />
    <!--<link href="../style.css" rel="stylesheet" type="text/css" />!-->
    <style>
      html, body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        min-height: 100vh;
      }
      body {
        background-image: url(../../assets/main_background.png);
        background-repeat: no-repeat;
        background-position: right top;
        background-attachment: fixed;
        background-size: cover;
        /*padding: 20px;
        max-width: 700px;
        margin: auto;*/
      }
      .box-wrapper-700 {
        max-width: 700px;
        margin: auto;
      }
      .cart {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        background-color: white; /* Make cart box solid white */
        box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Optional: nicer visual */
      }
      ul {
        list-style: none;
        padding-left: 0;
      }
      li {
        display: flex;
        align-items: center;
        margin-bottom: 16px;
      }
      li img {
        width: 60px;
        height: auto;
        margin-right: 12px;
        border-radius: 4px;
      }
      .item-details {
        flex: 1;
      }
      .remove-btn {
        background: #c62828;
        color: white !important;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        margin-left: 12px;
        height: 32px;
        -webkit-text-stroke: 0; /* REMOVE any stroke */
        text-stroke: 0; 
      }
      .empty-message {
        text-align: center;
        padding: 40px;
      }
      #paypal-button-container {
        margin-top: 20px;
      }
      tandc-text {
        color: white;
        text-align: center;
        font-family: "Arial Black", sans-serif;
        font-size: 12px;
        padding: 15px;
        max-width: 90%; /* Ensures the text doesn't span the entire width */
        margin: 0 auto; /* Centers the text block within the container */
      }
      .tandc-text-bold {
        color: white;
        text-align: center;
        font-family: "Arial Black", sans-serif;
        font-size: 12px;
        padding: 15px;
        max-width: 90%; /* Ensures the text doesn't span the entire width */
        margin: 0 auto; /* Centers the text block within the container */
        font-weight: bold; /* Ensures the text is bold */
      }
      /* Adjust padding for mobile screens */
      @media (max-width: 600px) {
        tandc-text, tandc-text-bold {
          padding: 10px;  /* Smaller padding for phone screens */
        }
      }
      tandcfooter {
        color: white;
        text-align: center;
        font-family: "Arial", sans-serif;
        font-size: 10px;
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333333; /* Background color */
        border-radius: 20px; /* Rounded corners for an oval effect */
        padding: 5px 20px; /* Adds padding around the text */
        display: inline-block; /* Ensure the background wraps only around the text */
        white-space: nowrap; /* Prevent wrapping inside the footer */
        max-width: 90%; /* Prevent the footer from stretching too wide */
        box-sizing: border-box; /* Include padding in the width calculation */
      }
      /* Text and link styles for T&C and designer name */
      .footer-tc-text, .designer {
        color: red; /* Text color for both */
        padding: 0; /* Remove padding */
        display: inline; /* Display text inline to remove extra space */
        text-align: center; /* Center the text inside the inline-block */
        margin: 0; /* Ensure no margin between elements */
        background-color: transparent; /* Remove the background color */
      }
      .designer {
        text-decoration: none;
      }    
      /* Ensure no extra space between inline-block elements */
      footer {
        font-size: 0; /* Eliminate gaps between inline-block elements */
      }
      
      footer .footer-text, footer .footer-tc-text, footer .designer {
        font-size: 10px; /* Reset font size for elements to desired size */
      }
      /* Style the T&C link */
      footer a.footer-tc-text {
        text-decoration: none; /* Remove underline */
        color: inherit; /* Ensure the link color is inherited */
      }
      /* Hover effect on T&C text */
      .footer-tc-text:hover {
        color: #24252b; /* Color change on hover */
      }
      /* Shop T&C Text Style */
      .shop-tc-text {
        font-size: 20px; /* Adjusted size to 20px */
        font-weight: bold; /* Bold text */
        color: red; /* Transparent fill color */
        text-decoration: underline; /* Add underline */
        cursor: pointer; /* Pointer cursor to indicate it's clickable */
        padding-left: 10px; /* Space between "Order" and "T&C" */
      }
      /* Hover effect for Shop T&C text */
      .shop-tc-text:hover {
        color: #24252b; /* Color change on hover */
      }
      /* Links style */
      .t7c-links {
        color: red; /* Set the link text color to red */
        text-decoration: none; /* Remove underline */
      }
      .t7c-links:visited {
        color: red; /* Set visited links to red as well */
      }
      .t7c-links:hover {
        text-decoration: underline; /* Add underline on hover */
      }
      /* Responsive Design for Mobile */
      @media screen and (max-width: 500px) {
        page-title {
          font-size: 48px;
        }
        titles {
          font-size: 16px;
        }
        tandcfooter {
          font-size: 10px;
        }
      } 
      /* Ensure all nav items use consistent layout */
      .nav-list {
        display: flex;
        flex-direction: row-reverse;
        list-style: none;
        padding: 0;
        margin: 0;
        gap: 10px;
        align-items: center;
      }
      
      .nav-list li {
        display: inline-block;
      }
      
      .nav-item {
        display: flex;
        align-items: center;
      }
      
      .nav-link, .page-button {
        display: block;
        color: red;
        text-align: center;
        padding: 0.625rem 1.25rem; /* Proportional padding */
        text-decoration: none;
        border-radius: 0.3125rem; /* Rounded corners */
        box-shadow: 0.3125rem 0.3125rem 0.625rem red; /* Responsive shadow */
        background-color: white;
        font-weight: bold;
        margin: 0.3125rem; /* Responsive margin */
      }
      
      .page-button {
        background-color: #5d5d5d;
        color: #ffffff;
      }
      
      .nav-link:hover {
        background-color: red;
        color: white;
        box-shadow: 0.3125rem 0.3125rem 0.9375rem white; /* Adjusted shadow for hover */
      }
      
      @media screen and (max-width: 1024px) {
        .nav-link, .page-button {
          font-size: 0.875rem; /* Slightly smaller for tablets */
          padding: 0.5rem 1rem; 
        }
      }
      
      @media screen and (max-width: 500px) {
        .nav-link, .page-button {
          font-size: 0.75rem; /* Smaller for phones */
          padding: 0.375rem 0.75rem; 
        }
      }
      .cart-header {
        font-size: 24px; /* Text size */
        font-weight: bold; /* Bold text */
        color: #6e6d68; /* Transparent fill color */
        -webkit-text-stroke: 1px #24252b; /* Outline effect */
        margin: 10px 0; /* Space around the title */
        text-align: center;
      }
        }
      /* Description below title */
     .product-description {
        font-weight: bold;
        font-size: 15px; /* Text size */
        /*font-weight: bold; /* Bold text */
        color: #6e6d68; /* Transparent fill color */
        -webkit-text-stroke: 0.7px #24252b; /* Outline effect */
        margin: 5px 0; /* Space around the title */
      }


      .product-description-bold {
        font-weight: bold;
        font-size: 18px; /* Text size */
        /*font-weight: bold; /* Bold text */
        color: #6e6d68; /* Transparent fill color */
        -webkit-text-stroke: 1px #24252b; /* Outline effect */
        margin: 10px 0; /* Space around the title */
      }
      
      /* Total styling */
      .cart-total-label {
        font-size: 20px; /* Adjusted size to 20px */
        font-weight: bold !important; /* Force bold text */
        color: #6e6d68; /* Transparent fill color */
        -webkit-text-stroke: 1px #24252b; /* Outline effect */
        margin-right: 10px; /* Control spacing between price and button */
        text-align: center;
      }
      .cart-postage-label {
        font-size: 15px; /* Adjusted size to 20px */
        font-weight: bold !important; /* Force bold text */
        color: #6e6d68; /* Transparent fill color */
        -webkit-text-stroke: 0.7px #24252b; /* Outline effect */
        margin-right: 10px; /* Control spacing between price and button */
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="nav-wrapper">
      <ul class="nav-list">
        <li class="nav-item">
          <a href="https://shop.donalogaora.com/checkout" class="page-button">Cart</a>
        </li>
        <li class="nav-item">
          <a href="https://shop.donalogaora.com" class="nav-link">Shop</a>
        </li>
        <li class="nav-item">
          <a href="https://www.donalogaora.com" class="nav-link">Home</a>
        </li>
      </ul>
    </div>
    <br><br>
    <div class="box-wrapper-700">
      <script src="https://www.paypal.com/sdk/js?client-id=AYyHjVONn6BNCkOwITWnMz4_u636NWpdMkQgLe1ZbmlHGGIhEjXBZfzDDNzs8Ee_qa3I-vAPuWAJSC-l&currency=EUR"></script>
      <div class="cart">
        <h2 class="cart-header">Your Cart</h2>
        <ul 
          id="cart-items" 
          class="product-description" 
          style="
            font-weight: bold;
            font-size: 18px;
            color: #6e6d68;
            -webkit-text-stroke: 1px #24252b;
            margin: 10px 0;
          "
        ></ul>
        <p class="cart-total-label">Total: €<span>0.00</span></p>
        <p class="cart-postage-label">
          <strong>Note:</strong> Maximum of 4 items per purchase.<br><br>
          Postage will be added at checkout: €4.00 for 1–2 items, €5.10 for 3–4 items.
        </p>
      </div>
      <div id="paypal-button-container"></div>
      <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const BACKEND_URL = 'https://shop-api.donalogaora.com';
      
        async function fetchPostage(subtotal) {
          try {
            const response = await fetch(`${BACKEND_URL}/api/calculate-postage`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ subtotal })
            });
            const data = await response.json();
            return data.postage ?? 0;
          } catch (err) {
            console.error('Postage fetch failed', err);
            return 0;
          }
        }
      
        async function renderCart() {
          const cartItemsContainer = document.getElementById('cart-items');
          const totalEl = document.querySelector('.cart-total-label span');
      
          if (!cartItemsContainer) return;
      
          if (cart.length === 0) {
            cartItemsContainer.innerHTML = '<p class="empty-message">Your cart is empty.</p>';
            totalEl.textContent = '0.00';
            return;
          }
      
          cartItemsContainer.innerHTML = '';
          let subtotal = 0;
      
          cart.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = `
              <img src="${item.image || ''}" alt="${item.name} - ${item.color}">
              <div class="item-details">
                <div class="product-description-bold">${item.name}</div>
                <div class="product-description" style="
                  font-weight: bold;
                  font-size: 15px;
                  color: #6e6d68;
                  -webkit-text-stroke: 0.7px #24252b;
                  margin: 10px 0;
                ">Colour: ${item.color}</div>
                <div class="product-description" style="
                  font-weight: bold;
                  font-size: 15px;
                  color: #6e6d68;
                  -webkit-text-stroke: 0.7px #24252b;
                  margin: 10px 0;
                ">Price: €${item.price.toFixed(2)} x ${item.qty}</div>
              </div>
              <button class="remove-btn" data-id="${item.id}" data-color="${item.color}">Remove</button>
            `;
            cartItemsContainer.appendChild(li);
            subtotal += item.price * item.qty;
          });
      
          const postage = await fetchPostage(subtotal);
          const total = subtotal + postage;
    
          totalEl.textContent = total.toFixed(2);
        }
      
        document.getElementById('cart-items').addEventListener('click', (event) => {
          if (event.target.classList.contains('remove-btn')) {
            const id = event.target.getAttribute('data-id');
            const color = event.target.getAttribute('data-color');
        
            // Find the item index
            const index = cart.findIndex(item => item.id === id && item.color === color);
            if (index > -1) {
              if (cart[index].qty > 1) {
                cart[index].qty -= 1;  // Just reduce qty by 1
              } else {
                cart.splice(index, 1);  // Remove item if qty reaches 0
              }
              localStorage.setItem('cart', JSON.stringify(cart));
              renderCart();
            }
          }
        });
  
      
        paypal.Buttons({
          createOrder: function(data, actions) {
            const orderItems = cart.map(item => ({
              productId: item.id,
              quantity: item.qty
            }));
      
            return fetch(`${BACKEND_URL}/api/create-order`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ items: orderItems })
            })
            .then(res => res.json())
            .then(data => {
              if (!data.id) throw new Error('No order ID from backend');
              return data.id;
            });
          },
      
          onApprove: function(data) {
            return fetch(`${BACKEND_URL}/api/capture-order`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ orderId: data.orderID })
            })
            .then(res => res.json())
            .then(details => {
              if (details.status === 'COMPLETED') {
                alert(`Thank you, ${details.payer.name.given_name}! Your order is confirmed.`);
                localStorage.removeItem('cart');
                window.location.href = `thank-you/index.html?name=${encodeURIComponent(details.payer.name.given_name)}`;
              } else {
                alert('Payment not completed');
              }
            })
            .catch(err => {
              console.error(err);
              alert('Payment failed. Please try again.');
            });
          },
      
          onError: function(err) {
            console.error('PayPal error', err);
            alert('An error occurred with PayPal.');
          }
        }).render('#paypal-button-container');
      
        renderCart();
      </script>
      <br><br><br><br><br><br>
      <tandcfooter>
         <span class="footer-text">shop.donalogaora.com </span>
            <a href="https://shop.donalogaora.com/terms-and-conditions" class="footer-tc-text" target="_blank" rel="noopener noreferrer">T&Cs</a><br>
         <span class="footer-text">© 2025 
            <a href="https://www.github.com/donalogaora" class="designer" target="_blank">Dónal Ó Gaora</a>. All Rights Reserved.
         </span><br>
         <span class="footer-text">Designed by 
            <a href="https://www.github.com/donalogaora" class="designer" target="_blank">Dónal Ó Gaora</a>
         </span>
      </tandcfooter>
    </div>
  </body>
</html>
